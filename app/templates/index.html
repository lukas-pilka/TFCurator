{% extends "base.html" %}
{% block content %}

<div class="container">

    <section class="mainSection titleScreen" id="exhibitionStart">
        <div class="titlePart">
            <h1>{{ searchedObjects[0]}}</h1>
            <p class="subtitle flexItem">
            {% if searchedObjects|length > 1%}
                & {{ searchedObjects[1]}}<br>
            {% endif%}
                Generated exhibition based on computer vision and big cultural data
            </p>
            <form action="" method="post" novalidate>
                {{ form.hidden_tag() }}
                <p>
                    {{ form.searchedItem.label }}<br>
                    {{ form.searchedItem }}<br>
                    {% for error in form.searchedItem.errors %}
                    <span style="color: red;">[{{ error }}]</span>
                    {% endfor %}
                </p>
                <p>{{ form.submit() }}</p>
            </form>

        </div>
        <div class="footerPart">
            <p>
                <a href="/" class="button">Generate new exhibition</a>
            </p>
        </div>
    </section>


    <!-- title image -->
    <section class="titleImage artwork">
        <div class="imageContainer">
            <img src="{{titleImage._source.image_url}}">
            <div class="boundBoxes">
                {% for detectedObject in titleImage._source.detected_objects %}
                <div class="boundBox"
                     style="left:{{ detectedObject.boundBox[1]*100 }}%; top: {{ detectedObject.boundBox[0]*100 }}%; width:{{ detectedObject.boundBox[3]*100 - detectedObject.boundBox[1]*100}}%; height: {{ detectedObject.boundBox[2]*100 - detectedObject.boundBox[0]*100}}%;">
                    <p>{{ detectedObject['object'] }}&nbsp;{{ 100*detectedObject['score']}}%</p>
                </div>
                {% endfor %}
            </div>
        </div>
    </section>

    <!-- Main Intro -->
    <section class="mainSection galleryIntro">
        <div class="introPart introTitle ">
            <h2>Data & History</h2>
            <p class="subtitle">
            {{ searchedObjects[0]}}
            {% if searchedObjects|length > 1%}
                & {{ searchedObjects[1]}}
            {% endif%} frequency over the ages
            </p>
        </div>
        <div class="introPart chart">
            {% set chartLineColors = ['#111','#2a9d8f','#e9c46a','#f4a261','#e76f51'] %}
            <canvas id="line-chart" width="800" height="450"></canvas>
            <p class="chartLegend">
            {% for i in range(artworksInPeriod.artworksWithObject|length) %}
                <span class="hint">
                    <span class="colorDot" style="background:{{chartLineColors[i]}}";></span>
                    {{artworksInPeriod.artworksWithObject[i][0]}}
                </span>
            {% endfor %}
            </p>

        </div>
        <article class="introPart detailInformation">
            <p>The histogram shows the quotient of images on which the searched motif was detected in relation to the total number of images in the database.</p>
            <p>The Digital Curator experiment attempts to demonstrate some of the basic capabilities of computer image recognition applied on cultural big data. With the help of Tensor Flow machine learning platform and Elasticsearch search engine, <strong>it&nbsp;explored {{galleriesSum['artworks count']}} digitized paintings, drawings and graphic prints from {{galleriesSum['galleries count']}} museums in Austria, Bavaria, Czech Republic and Slovakia.</strong> It recognized persons, icons, symbols and more than 1 000 diverse objects, marked their positions in the image and gave a precise measure of the certainty of own estimation. Finally, it prepared an online exposition presenting the most relevant works <strong>in {{ g.request_time() }}ec.</strong></p>
        </article>
    </section>


    <!-- Galleries -->
    <!-- unpacking collections -->
    {% for collectionIndex in range(artworksForWeb|length) %}
    <section class="mainSection galleryShowcase">
        <div class="introPart introTitle ">
            <h2>{{ searchedObjects[collectionIndex]}}</h2>
        </div>

        <!-- unpacking periods -->
        {% for period in artworksForWeb[collectionIndex] %}

            <!-- unpacking period -->
            {% for periodTitle, artworks in period.items() %}
            <div class="periodIntro">
                <p class="periodTitle subtitle">{{periodTitle}}</p>
            </div>

                <!-- unpacking artworks -->
                {% for artwork in artworks %}
                <div class="artwork">
                    <div class="imageContainer">
                        <img src="{{ artwork._source.image_url }}">
                        <div class="boundBoxes">

                            <!-- unpacking boundboxes-->
                            {% for detectedObject in artwork._source.detected_objects %}
                            <div class="boundBox" style="left:{{ detectedObject .boundBox[1]*100 }}%; top: {{ detectedObject.boundBox[0]*100 }}%; width:{{ detectedObject.boundBox[3]*100 - detectedObject.boundBox[1]*100}}%; height: {{ detectedObject.boundBox[2]*100 - detectedObject.boundBox[0]*100}}%;">
                                <p>{{ detectedObject.object }}&nbsp;{{ 100*detectedObject.score }}%</p>
                            </div>
                            {% endfor %}

                        </div>
                    </div>

                    <div class="artworkDescription">
                        <p class="museumInfo">
                            {{ artwork._source.title }} <br>
                            {{ artwork._source.author[0] }}<br>
                            {% if artwork._source.date_earliest == artwork._source.date_latest %}
                                {{ artwork._source.date_earliest }}
                            {% else %}
                                between {{ artwork._source.date_earliest }}&nbsp;and&nbsp;{{ artwork._source.date_latest }}

                            {% endif %}

                            <br>
                            {{ artwork._source.gallery }}<br>
                        </p>
                        <p class="generatedInfo">
                            {{ searchedObjects[collectionIndex] }}:&nbsp;{{ 100*artwork._source.average_score }}%
                        </p>
                    </div>
                </div>
                {% endfor %}

            {% endfor %}

        {% endfor %}

    </section>
    {% endfor %}


    <!-- final screen -->
    <div class="mainSection finalScreen">
        <div class="titlePart">
            <h1>Goodbye</h1>
        </div>
        <div class="footerPart">
            <p>
                <a href="/" class="button">Generate new exhibition</a>
            </p>
            <p class="copyleft">
                <a href="http://lukaspilka.cz/" target="_blank">Lukas Pilka, 2020</a>
            </p>
        </div>
    </div>

</div>

<!-- chart data -->
<script>

    // Global parameters for all charts:
    Chart.defaults.global.responsive = false;
    Chart.defaults.global.defaultFontColor = '#111111';
    Chart.defaults.global.defaultFontSize = 16;
    Chart.defaults.global.defaultFontFamily = "'Montserrat', sans-serif";
    Chart.defaults.global.tooltips.backgroundColor = "#111111";
    Chart.defaults.global.tooltips.titleFontSize = 16;
    Chart.defaults.global.tooltips.bodyFontSize = 16;
    Chart.defaults.global.tooltips.cornerRadius = 0;
    Chart.defaults.global.tooltips.xPadding = 20;
    Chart.defaults.global.tooltips.yPadding = 20;
    Chart.defaults.global.tooltips.borderColor = '#111111';
    Chart.defaults.global.tooltips.borderWidth = 1;
    Chart.defaults.global.tooltips.displayColors = true;
    Chart.defaults.scale.gridLines.display = false;
    Chart.defaults.scale.ticks.beginAtZero = true;

    // Bar chart
    new Chart(document.getElementById("line-chart"), {
        type: 'line',
        data: {
            labels: {{artworksInPeriod.periods}},
            datasets: [

                {% for i in range(artworksInPeriod.artworksWithObject|length) %}
                {
                    label: "{{artworksInPeriod.artworksWithObject[i][0]}}",
                    backgroundColor: "rgba(255, 255, 255, 0)",
                    pointBackgroundColor: "{{chartLineColors[i]}}",
                    borderColor: "{{chartLineColors[i]}}",
                    pointRadius: 4,
                    pointHoverRadius: 6,
                    data: {{artworksInPeriod.artworksWithObject[i][2]}}
                },
                {% endfor%}

            ]
        },
        options: {
            legend: {display: false},
            title: {display: true},
            tooltips: {
                callbacks: {
                    title: function(tooltipItems, data) {
               return data.datasets[tooltipItems[0].datasetIndex].label;
						},
				label: function(tooltipItem, data) {
                        return ' '+tooltipItem.yLabel.toString() + ' %';

						}
                },
            },
            scales: {
                yAxes: [{
                    ticks: {
                        callback: function(value, index, values) {
                            return value + ' %';
                        }
                    }
                }]
            }
        },
    });
</script>




{% endblock %}